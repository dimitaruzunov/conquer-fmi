<!DOCTYPE html>
<html>
<head>
	<title>Conquer FMI</title>
	<style type="text/css">
	table.map td{
		padding:50px;
		border:solid 1px black;
	}
	</style>
	<script src="socket.io/socket.io.js"></script>
	<script src="../../lib/jquery/dist/jquery.min.js"></script>
</head>
<body>
	
	<script>
		var map = [
			[0,0,0,0],
			[0,0,0,0]
		], id, selectedArea;
		//TODO: add config file
		var socket = io.connect('http://localhost:3030');
		//var socket = io.connect('http://localhost:8080');

		socket.on('connect', function(){
			socket.emit('adduser', "krisko");
		});
		socket.on('setPlayer', function(data){
			id = parseInt(data);
			if(id==1) $("#player").css("color", "blue");
			if(id==2) $("#player").css("color", "red");
			$("#player").text(data);
		});
		socket.on('selectArea', function(data){
			var axis = JSON.parse(data);
			map[axis.y][axis.x] = axis.id;
			updateMap()
		});
		socket.on('selectEnemyArea', function(data){
			var axis = JSON.parse(data);
			map[axis.y][axis.x] = axis.id;
			updateMap();
		});
		socket.on('askQuestion', function(){
			if(prompt("2+3=?")==5){
				socket.emit('selectField', selectedArea);
			}else{

			}
		});
		
		$(function(){
			$('#datasend').click( function() {
				var message = $('#data').val();
				$('#data').val('');
				socket.emit('sendchat', message);
			});
			$("td").click(function(){
				socket.emit('serverAskQuestion');
				selectedArea = JSON.stringify({x:$(this).index(), y:$(this).parent().index(), id:id});		
			})
		});

		function updateMap(){
			for(var row in map){
				for(column in map[row]){
					console.log(row+","+column+"="+map[row][column]);
					if(map[row][column] == 1){
						$("#area"+row+column).css("background-color", "blue");
					}else if(map[row][column] == 2){
						$("#area"+row+column).css("background-color", "red");
					}
				}
			}
		}
	</script>
	<h2>Player <span id="player"></span></h2>
	<p>Choose position</p>
	<table class="map">
		<tr>
			<td id="area00"> </td>
			<td id="area01"> </td>
			<td id="area02"> </td>
			<td id="area03"> </td>
		</tr>
		<tr>
			<td id="area10"> </td>
			<td id="area11"> </td>
			<td id="area12"> </td>
			<td id="area13"> </td>
		</tr>
	</table>
</body>
</html>
